--GUIAS 11 (Consultas)
SELECT X.DT_EMISSAO_GUIA, X.AA_GUIA_ATENDIMENTO, X.NR_GUIA_ATENDIMENTO, X.NM_GRUPO, X.DT_VENC,
       X.H_SEQ_INICIO PRI_SEQ_ALT, CASE WHEN U1.COD_USUARIO IS NULL THEN H1.CD_USERID_ALT ELSE U1.NOM_USUARIO END PRI_USER_ALT, 
       X.H_SEQ_FINAL ULT_SEQ_ALT,  CASE WHEN U2.COD_USUARIO IS NULL THEN H2.CD_USERID_ALT ELSE U2.NOM_USUARIO END ULT_USER_ALT,
       X.NM_USUARIO, X.CD_UNIDADE_CARTEIRA, X.CD_CARTEIRA_USUARIO, X.LOCAL, X.CD_TIPO_GUIA, X.DS_TIPO_GUIA,
       X.CD_UNIDADE_PRINCIPAL, X.CD_PRESTADOR_PRINCIPAL, X.PRINCIPAL, X.PROF_SOLICITANTE, X.SOLICITANTE, X.IN_LIBERADO_GUIAS
  FROM ( SELECT V.DT_EMISSAO_GUIA, V.CD_TIPO_GUIA, V.DS_TIPO_GUIA, V.AA_GUIA_ATENDIMENTO, V.NR_GUIA_ATENDIMENTO, V.NM_USUARIO, V.CD_UNIDADE_CARTEIRA, 
                V.LOCAL, V.CD_CARTEIRA_USUARIO, V.AA_GUIA_ATEND_ORIGEM, V.NR_GUIA_ATEND_ORIGEM GUIA_ORIGEM, V.NM_GRUPO, V.CD_UNIDADE_PRINCIPAL, 
                V.CD_PRESTADOR_PRINCIPAL, V.PRINCIPAL, V.PROF_SOLICITANTE, V.SOLICITANTE, V.COD_LIB_GUIAS, V.IN_LIBERADO_GUIAS, V.DT_VENCIMENTO DT_VENC, 
                MIN(H.NR_SEQUENCIA_ALT) H_SEQ_INICIO, MAX(H.NR_SEQUENCIA_ALT) H_SEQ_FINAL, V.DES_TIP_FATURAM, V.ELETIVO_URGENCIA
           FROM GP.V_ANALITICO_GUIAS V INNER JOIN GP.GUIA_HIS H ON H.AA_GUIA_ATENDIMENTO = V.AA_GUIA_ATENDIMENTO AND H.NR_GUIA_ATENDIMENTO = V.NR_GUIA_ATENDIMENTO
                                     LEFT JOIN GP.PRESERV P2 ON P2.CD_PRESTADOR       = V.CDPRESTADORSOLICITANTE
          WHERE V.DT_EMISSAO_GUIA BETWEEN $gDTINICIO$ AND $gDTFINAL$
            AND V.CD_TIPO_GUIA = 11 /* CONSULTA - ATENDIMENTO */ AND H.IN_LIB_GUIAS_ALT = 2 /* GUIAS AUTORIZADAS */
            /*AND NOT P2.CD_GRUPO_PRESTADOR IN ( 10, 15, 67 )   */
            AND V.COD_LIB_GUIAS   IN ( 2, 4, 5, 9, 10 )
          GROUP BY V.DT_EMISSAO_GUIA, V.CD_TIPO_GUIA, V.DS_TIPO_GUIA, V.AA_GUIA_ATENDIMENTO, V.NR_GUIA_ATENDIMENTO, V.NM_USUARIO, V.CD_UNIDADE_CARTEIRA, 
                   V.LOCAL, V.CD_CARTEIRA_USUARIO, V.AA_GUIA_ATEND_ORIGEM, V.NR_GUIA_ATEND_ORIGEM, V.NM_GRUPO, V.CD_UNIDADE_PRINCIPAL, 
                   V.CD_PRESTADOR_PRINCIPAL, V.PRINCIPAL, V.PROF_SOLICITANTE, V.SOLICITANTE, V.IN_LIBERADO_GUIAS, V.DT_VENCIMENTO, V.DES_TIP_FATURAM, 
                   V.ELETIVO_URGENCIA, V.COD_LIB_GUIAS ) X 
 INNER JOIN GP.GUIA_HIS H1 ON H1.AA_GUIA_ATENDIMENTO = X.AA_GUIA_ATENDIMENTO AND H1.NR_GUIA_ATENDIMENTO = X.NR_GUIA_ATENDIMENTO AND H1.NR_SEQUENCIA_ALT = X.H_SEQ_INICIO
 INNER JOIN GP.GUIA_HIS H2 ON H2.AA_GUIA_ATENDIMENTO = X.AA_GUIA_ATENDIMENTO AND H2.NR_GUIA_ATENDIMENTO = X.NR_GUIA_ATENDIMENTO AND H2.NR_SEQUENCIA_ALT = X.H_SEQ_FINAL
  LEFT JOIN EMSFND.USUAR_MESTRE U1 ON H1.CD_USERID_ALT = U1.COD_USUARIO LEFT JOIN EMSFND.USUAR_MESTRE U2 ON H2.CD_USERID_ALT = U2.COD_USUARIO
 --WHERE ( H1.CD_USERID_ALT IN ( SELECT S.COD_USUARIO FROM SAN_ATENDENTES S ) OR H2.CD_USERID_ALT IN ( SELECT S.COD_USUARIO FROM SAN_ATENDENTES S ) )
WHERE CD_UNIDADE_CARTEIRA = 




--GUIAS 21 (Exames)
SELECT X.DT_EMISSAO_GUIA, X.AA_GUIA_ATENDIMENTO, X.NR_GUIA_ATENDIMENTO, X.NM_GRUPO, X.DT_VENC,
       X.H_SEQ_INICIO PRI_SEQ_ALT, CASE WHEN U1.COD_USUARIO IS NULL THEN H1.CD_USERID_ALT ELSE U1.NOM_USUARIO END PRI_USER_ALT, 
       X.H_SEQ_FINAL ULT_SEQ_ALT,  CASE WHEN U2.COD_USUARIO IS NULL THEN H2.CD_USERID_ALT ELSE U2.NOM_USUARIO END ULT_USER_ALT,
       X.NM_USUARIO, X.CD_UNIDADE_CARTEIRA, X.CD_CARTEIRA_USUARIO, X.LOCAL, X.CD_TIPO_GUIA, X.DS_TIPO_GUIA,
       X.CD_UNIDADE_PRINCIPAL, X.CD_PRESTADOR_PRINCIPAL, X.PRINCIPAL, X.PROF_SOLICITANTE, X.SOLICITANTE, X.IN_LIBERADO_GUIAS
  FROM ( SELECT V.DT_EMISSAO_GUIA, V.CD_TIPO_GUIA, V.DS_TIPO_GUIA, V.AA_GUIA_ATENDIMENTO, V.NR_GUIA_ATENDIMENTO, V.NM_USUARIO, V.CD_UNIDADE_CARTEIRA, 
                V.LOCAL, V.CD_CARTEIRA_USUARIO, V.AA_GUIA_ATEND_ORIGEM, V.NR_GUIA_ATEND_ORIGEM GUIA_ORIGEM, V.NM_GRUPO, V.CD_UNIDADE_PRINCIPAL, 
                V.CD_PRESTADOR_PRINCIPAL, V.PRINCIPAL, V.PROF_SOLICITANTE, V.SOLICITANTE, V.COD_LIB_GUIAS, V.IN_LIBERADO_GUIAS, V.DT_VENCIMENTO DT_VENC, 
                MIN(H.NR_SEQUENCIA_ALT) H_SEQ_INICIO, MAX(H.NR_SEQUENCIA_ALT) H_SEQ_FINAL, V.DES_TIP_FATURAM, V.ELETIVO_URGENCIA
           FROM GP.V_ANALITICO_GUIAS V INNER JOIN GP.GUIA_HIS H ON H.AA_GUIA_ATENDIMENTO = V.AA_GUIA_ATENDIMENTO AND H.NR_GUIA_ATENDIMENTO = V.NR_GUIA_ATENDIMENTO
                                     LEFT JOIN GP.PRESERV P2 ON P2.CD_PRESTADOR       = V.CDPRESTADORSOLICITANTE
          WHERE V.DT_EMISSAO_GUIA BETWEEN $gDTINICIO$ AND $gDTFINAL$
            AND V.CD_TIPO_GUIA = 21 /* EXAME - ATENDIMENTO AND H.IN_LIB_GUIAS_ALT = 2  GUIAS AUTORIZADAS */
          /*  AND NOT P2.CD_GRUPO_PRESTADOR IN ( 10, 15, 67 )   */
           AND V.COD_LIB_GUIAS   IN ( 2, 4, 5, 9, 10 )
          GROUP BY V.DT_EMISSAO_GUIA, V.CD_TIPO_GUIA, V.DS_TIPO_GUIA, V.AA_GUIA_ATENDIMENTO, V.NR_GUIA_ATENDIMENTO, V.NM_USUARIO, V.CD_UNIDADE_CARTEIRA, 
                   V.LOCAL, V.CD_CARTEIRA_USUARIO, V.AA_GUIA_ATEND_ORIGEM, V.NR_GUIA_ATEND_ORIGEM, V.NM_GRUPO, V.CD_UNIDADE_PRINCIPAL, 
                   V.CD_PRESTADOR_PRINCIPAL, V.PRINCIPAL, V.PROF_SOLICITANTE, V.SOLICITANTE, V.IN_LIBERADO_GUIAS, V.DT_VENCIMENTO, V.DES_TIP_FATURAM, 
                   V.ELETIVO_URGENCIA, V.COD_LIB_GUIAS ) X 
 INNER JOIN GP.GUIA_HIS H1 ON H1.AA_GUIA_ATENDIMENTO = X.AA_GUIA_ATENDIMENTO AND H1.NR_GUIA_ATENDIMENTO = X.NR_GUIA_ATENDIMENTO AND H1.NR_SEQUENCIA_ALT = X.H_SEQ_INICIO
 INNER JOIN GP.GUIA_HIS H2 ON H2.AA_GUIA_ATENDIMENTO = X.AA_GUIA_ATENDIMENTO AND H2.NR_GUIA_ATENDIMENTO = X.NR_GUIA_ATENDIMENTO AND H2.NR_SEQUENCIA_ALT = X.H_SEQ_FINAL
  LEFT JOIN EMSFND.USUAR_MESTRE U1 ON H1.CD_USERID_ALT = U1.COD_USUARIO LEFT JOIN EMSFND.USUAR_MESTRE U2 ON H2.CD_USERID_ALT = U2.COD_USUARIO
-- WHERE ( H1.CD_USERID_ALT IN ( SELECT S.COD_USUARIO FROM SAN_ATENDENTES S ) OR H2.CD_USERID_ALT IN ( SELECT S.COD_USUARIO FROM SAN_ATENDENTES S ) )
WHERE CD_UNIDADE_CARTEIRA = 







--GUIAS 31 (Internações)
SELECT X.DT_EMISSAO_GUIA, X.AA_GUIA_ATENDIMENTO, X.NR_GUIA_ATENDIMENTO, X.NM_GRUPO, X.DT_VENC,
       X.H_SEQ_INICIO PRI_SEQ_ALT, CASE WHEN U1.COD_USUARIO IS NULL THEN H1.CD_USERID_ALT ELSE U1.NOM_USUARIO END PRI_USER_ALT, 
       X.H_SEQ_FINAL ULT_SEQ_ALT,  CASE WHEN U2.COD_USUARIO IS NULL THEN H2.CD_USERID_ALT ELSE U2.NOM_USUARIO END ULT_USER_ALT,
       X.NM_USUARIO, X.CD_UNIDADE_CARTEIRA, X.CD_CARTEIRA_USUARIO, X.LOCAL, X.CD_TIPO_GUIA, X.DS_TIPO_GUIA,
       X.CD_UNIDADE_PRINCIPAL, X.CD_PRESTADOR_PRINCIPAL, X.PRINCIPAL, X.PROF_SOLICITANTE, X.SOLICITANTE, X.IN_LIBERADO_GUIAS
  FROM ( SELECT V.DT_EMISSAO_GUIA, V.CD_TIPO_GUIA, V.DS_TIPO_GUIA, V.AA_GUIA_ATENDIMENTO, V.NR_GUIA_ATENDIMENTO, V.NM_USUARIO, V.CD_UNIDADE_CARTEIRA, 
                V.LOCAL, V.CD_CARTEIRA_USUARIO, V.AA_GUIA_ATEND_ORIGEM, V.NR_GUIA_ATEND_ORIGEM GUIA_ORIGEM, V.NM_GRUPO, V.CD_UNIDADE_PRINCIPAL, 
                V.CD_PRESTADOR_PRINCIPAL, V.PRINCIPAL, V.PROF_SOLICITANTE, V.SOLICITANTE, V.COD_LIB_GUIAS, V.IN_LIBERADO_GUIAS, V.DT_VENCIMENTO DT_VENC, 
                MIN(H.NR_SEQUENCIA_ALT) H_SEQ_INICIO, MAX(H.NR_SEQUENCIA_ALT) H_SEQ_FINAL, V.DES_TIP_FATURAM, V.ELETIVO_URGENCIA
           FROM GP.V_ANALITICO_GUIAS V INNER JOIN GP.GUIA_HIS H ON H.AA_GUIA_ATENDIMENTO = V.AA_GUIA_ATENDIMENTO AND H.NR_GUIA_ATENDIMENTO = V.NR_GUIA_ATENDIMENTO
                                     LEFT JOIN GP.PRESERV P2 ON P2.CD_PRESTADOR       = V.CDPRESTADORSOLICITANTE
          WHERE V.DT_EMISSAO_GUIA BETWEEN $gDTINICIO$ AND $gDTFINAL$
            AND V.CD_TIPO_GUIA = 31 /* INTERNACAO - ATENDIMENTO */ AND H.IN_LIB_GUIAS_ALT = 2 /* GUIAS AUTORIZADAS */
            /*AND NOT P2.CD_GRUPO_PRESTADOR IN ( 10, 15, 67 )   */
            AND V.COD_LIB_GUIAS   IN ( 2, 4, 5, 9, 10 )
          GROUP BY V.DT_EMISSAO_GUIA, V.CD_TIPO_GUIA, V.DS_TIPO_GUIA, V.AA_GUIA_ATENDIMENTO, V.NR_GUIA_ATENDIMENTO, V.NM_USUARIO, V.CD_UNIDADE_CARTEIRA, 
                   V.LOCAL, V.CD_CARTEIRA_USUARIO, V.AA_GUIA_ATEND_ORIGEM, V.NR_GUIA_ATEND_ORIGEM, V.NM_GRUPO, V.CD_UNIDADE_PRINCIPAL, 
                   V.CD_PRESTADOR_PRINCIPAL, V.PRINCIPAL, V.PROF_SOLICITANTE, V.SOLICITANTE, V.IN_LIBERADO_GUIAS, V.DT_VENCIMENTO, V.DES_TIP_FATURAM, 
                   V.ELETIVO_URGENCIA, V.COD_LIB_GUIAS ) X 
 INNER JOIN GP.GUIA_HIS H1 ON H1.AA_GUIA_ATENDIMENTO = X.AA_GUIA_ATENDIMENTO AND H1.NR_GUIA_ATENDIMENTO = X.NR_GUIA_ATENDIMENTO AND H1.NR_SEQUENCIA_ALT = X.H_SEQ_INICIO
 INNER JOIN GP.GUIA_HIS H2 ON H2.AA_GUIA_ATENDIMENTO = X.AA_GUIA_ATENDIMENTO AND H2.NR_GUIA_ATENDIMENTO = X.NR_GUIA_ATENDIMENTO AND H2.NR_SEQUENCIA_ALT = X.H_SEQ_FINAL
  LEFT JOIN EMSFND.USUAR_MESTRE U1 ON H1.CD_USERID_ALT = U1.COD_USUARIO LEFT JOIN EMSFND.USUAR_MESTRE U2 ON H2.CD_USERID_ALT = U2.COD_USUARIO
-- WHERE ( H1.CD_USERID_ALT IN ( SELECT S.COD_USUARIO FROM SAN_ATENDENTES S ) OR H2.CD_USERID_ALT IN ( SELECT S.COD_USUARIO FROM SAN_ATENDENTES S ) )
WHERE CD_UNIDADE_CARTEIRA = 